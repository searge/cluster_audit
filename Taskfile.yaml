---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

vars:
  UV_ENV: "env VIRTUAL_ENV={{.PWD}}/.venv UV_CACHE_DIR=.uv-cache MYPY_CACHE_DIR=.mypy_cache PYLINTHOME=.pylint_cache"

tasks:
  default:
    desc: Show available tasks
    cmds:
      - task --list

  install:
    desc: Install/update dependencies
    cmds:
      - "{{.UV_ENV}} uv sync"

  mks:
    desc: "Run mks CLI without activating venv (example: task mks -- resource-audit -h)"
    cmds:
      - '{{.UV_ENV}} uv run mks {{.CLI_ARGS | default "--help"}}'

  lint:
    desc: Run code quality checks
    cmds:
      - "{{.UV_ENV}} uv run ruff format {{.CLI_ARGS | default '.'}}"
      - "{{.UV_ENV}} uv run ruff check --fix {{.CLI_ARGS | default '.'}}"
      - "{{.UV_ENV}} uv run ty check {{.CLI_ARGS | default '.'}}"
      - "{{.UV_ENV}} uv run pylint {{.CLI_ARGS | default '.'}} -j 1"

  typecheck:
    desc: Run type checking
    cmds:
      - "{{.UV_ENV}} uv run python -m mypy {{.CLI_ARGS | default '.'}}"
      - "{{.UV_ENV}} uv run pyright {{.CLI_ARGS | default '.'}}"

  test:
    desc: Run all checks
    deps: [lint, typecheck]
    cmds:
      - echo "âœ… All checks passed"

  clean:
    desc: Clean up old report files (>14 days)
    cmds:
      - find reports/ -name "*.csv" -type f -mtime +14 -delete
      - find reports/ -name "*.md" -type f -mtime +7 -delete
      - echo "ğŸ—‘ï¸ Cleanup completed"
